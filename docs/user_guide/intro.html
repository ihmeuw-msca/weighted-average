<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Installation" href="installation.html" /><link rel="prev" title="User Guide" href="index.html" />

    <meta name="generator" content="sphinx-4.4.0, furo 2022.01.02"/>
        <title>What is weave? - weave 0.1.0</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=df49af52631e7917044a9c21a57f7b83170a6dd0" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=fade93df149f7c5fedb3ff897f799dc7d283b420" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-brand-primary: #008080;
  --color-brand-content: #008080;
  --color-problematic: #BF5844;
  --color-background-secondary: #F8F8F8;
  
  }
  body[data-theme="dark"] {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #6FD8D1;
  --color-brand-content: #6FD8D1;
  --color-problematic: #FA9F50;
  --color-background-secondary: #202020;
  
  }
  @media (prefers-color-scheme: dark) {
    body:not([data-theme="light"]) {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #6FD8D1;
  --color-brand-content: #6FD8D1;
  --color-problematic: #FA9F50;
  --color-background-secondary: #202020;
  
    }
  }
</style></head>
  <body>
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" />
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">weave 0.1.0</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/logo/logo-light.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/logo/logo-dark.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">weave 0.1.0</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">User Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">What is <cite>weave</cite>?</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../api_reference/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/weave.smoother.html">weave.smoother</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/weave.dimension.html">weave.dimension</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/weave.kernels.html">weave.kernels</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api_reference/weave.distance.html">weave.distance</a></li>
</ul>
</li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <div class="section" id="what-is-weave">
<h1>What is <cite>weave</cite>?<a class="headerlink" href="#what-is-weave" title="Permalink to this headline">¶</a></h1>
<p>The <cite>weave</cite> package smooths data across multiple dimensions using weighted
averages with methods inspired by the spatial-temporal models developed in the
following paper:</p>
<p>Foreman, K.J., Lozano, R., Lopez, A.D., et al. “<a class="reference external" href="https://pophealthmetrics.biomedcentral.com/articles/10.1186/1478-7954-10-1">Modeling causes of death: an
integrated approach using CODEm</a>”,
Popul Health Metrics, vol. 10, no. 1, pp. 1-23, 2012.</p>
<div class="section" id="cause-of-death-ensemble-model">
<h2>Cause of Death Ensemble Model<a class="headerlink" href="#cause-of-death-ensemble-model" title="Permalink to this headline">¶</a></h2>
<p>The Cause of Death Ensemble model (CODEm) predicts cause-specific mortality for
a large number of countries. As an ensemble model, it combines results from
many model families to produce predictions with improved accuracy. Two of the
model families included in CODEm, called spatial-temporal models, use weighted
averages to smooth results across age, time, and location.</p>
<p>These spatial-temporal models are created in three stages. First, either the
logit of the cause fraction or the natural log of the death rate is modeled
using a linear mixed effects model. Next, spatial-temporal smoothing is used to
account for additional variations across age, time, and location. Finally,
Gaussian process regression is applied to predict uncertainty. We describe the
second stage, the inspiration for <cite>weave</cite>, in more detail.</p>
<div class="section" id="spatial-temporal-models">
<h3>Spatial-Temporal Models<a class="headerlink" href="#spatial-temporal-models" title="Permalink to this headline">¶</a></h3>
<p>After the first stage linear mixed effects models have been run, the residuals
are calculated (observed - predicted dependent variable). It is assummed that
these residuals contain patterns that vary systematically across age, time, and
location that are not captured by the linear mixed effects models.
Spatial-temporal smoothing is applied to the residuals and the result added to
the first stage predictions in an effort to account for this additional
information.</p>
<p>For each observation <span class="math notranslate nohighlight">\(i\)</span> in the data set <span class="math notranslate nohighlight">\(\mathcal{D}\)</span>, weights
are assigned to the remaining observations <span class="math notranslate nohighlight">\(j\)</span> based on their similarity
across age, time, and location. The predicted or smoothed residual
<span class="math notranslate nohighlight">\(\hat{r}\)</span> is then the weighted average of the residuals <span class="math notranslate nohighlight">\(r\)</span>,</p>
<div class="math-wrapper"><div class="math notranslate nohighlight">
\[\hat{r}_i = \sum_{j \in \mathcal{D}} w_{i, j} \, r_j.\]</div></div>
<p>Weights are calculated based on similarity in age,</p>
<div class="math-wrapper"><div class="math notranslate nohighlight">
\[w_{i, j}^a = \frac{1}{\exp(\omega \, |a_i - a_j|)}\]</div></div>
<p>similarity in year,</p>
<div class="math-wrapper"><div class="math notranslate nohighlight">
\[w_{i, j}^t = \left(1 - \left(\frac{|t_i - t_j|}
{\max_{k \in \mathcal{D}}|t_i - t_k| + 1}\right)^\lambda\right)^3,\]</div></div>
<p>and similarity in location,</p>
<div class="math-wrapper"><div class="math notranslate nohighlight">
\[\begin{split}w_{i, j}^\ell = \begin{cases} \zeta &amp; \text{same country}, \\
\zeta(1 - \zeta) &amp; \text{same region}, \\ (1 - \zeta)^2 &amp;
\text{same super region}, \\ 0 &amp; \text{otherwise}, \end{cases}\end{split}\]</div></div>
<p>and then combined into a single weight. Specifically, let
<span class="math notranslate nohighlight">\(\mathcal{D}_{i, j}\)</span> be the set of all indices <span class="math notranslate nohighlight">\(k \in \mathcal{D}\)</span>
such that <span class="math notranslate nohighlight">\(w_{i, k}^\ell = w_{i, j}^\ell\)</span> (e.g., if points <span class="math notranslate nohighlight">\(i\)</span> and
<span class="math notranslate nohighlight">\(j\)</span> belong to the same country, then set <span class="math notranslate nohighlight">\(\mathcal{D}_{i, j}\)</span> will
include all points in said country, etc.). Then the combined weights are given
by</p>
<div class="math-wrapper"><div class="math notranslate nohighlight">
\[\tilde{w}_{i, j} = w_{i, j}^\ell \, \frac{w_{i, j}^a \,
w_{i, j}^t}{\sum_{k \in \mathcal{D}_{i, j}} w_{i, k}^a \, w_{i, k}^t}.\]</div></div>
<p>Finally, weights are normalized so that all weights for each observation
<span class="math notranslate nohighlight">\(i\)</span> sum to one,</p>
<div class="math-wrapper"><div class="math notranslate nohighlight">
\[w_{i, j} = \frac{\tilde{w}_{i, j}}{\sum_{k \in \mathcal{D}}
\tilde{w}_{i, k}}.\]</div></div>
</div>
</div>
<div class="section" id="weighted-averages-with-weave">
<h2>Weighted Averages with <cite>weave</cite><a class="headerlink" href="#weighted-averages-with-weave" title="Permalink to this headline">¶</a></h2>
<p>The <cite>weave</cite> package generalizes the spatial-temporal models in CODEm to smooth
data across mutliple dimensions using weighted averages. Users can specify
dimensions using the <a class="reference internal" href="../api_reference/weave.dimension.html"><span class="doc">Dimension</span></a> class,
where <a class="reference internal" href="../api_reference/weave.distance.html"><span class="doc">distance</span></a> and
<a class="reference internal" href="../api_reference/weave.kernels.html"><span class="doc">kernel</span></a> functions determine how
weights are calculated.</p>
<p>Distance functions <span class="math notranslate nohighlight">\(d(x_i, x_j)\)</span> calculate the distance between points
<span class="math notranslate nohighlight">\(x_i\)</span> and <span class="math notranslate nohighlight">\(x_j\)</span>, and kernel functions
<span class="math notranslate nohighlight">\(k(d_{i, j} \, ; p_1, p_2, \dots)\)</span> calculate smoothing weights given
distance <span class="math notranslate nohighlight">\(d_{i, j}\)</span> and a set of parameters <span class="math notranslate nohighlight">\(p_1, p_2, \dots\)</span>. In
<cite>weave</cite>, you can choose from three distance functions and four kernel
functions.</p>
<p>Weighted averages <span class="math notranslate nohighlight">\(\hat{y}\)</span> of dependent variables <span class="math notranslate nohighlight">\(y\)</span> are
calculated using the <a class="reference internal" href="../api_reference/weave.smoother.html"><span class="doc">Smoother</span></a> class
for observations <span class="math notranslate nohighlight">\(i\)</span> in data set <span class="math notranslate nohighlight">\(\mathcal{D}\)</span> with</p>
<div class="math-wrapper"><div class="math notranslate nohighlight">
\[\hat{y}_i = \sum_{j \in \mathcal{D}} w_{i, j} \, y_j,\]</div></div>
<p>where weights are first calculated for dimensions <span class="math notranslate nohighlight">\(m \in \mathcal{M}\)</span>,
then multiplied,</p>
<div class="math-wrapper"><div class="math notranslate nohighlight">
\[\tilde{w}_{i, j} = \prod_{m \in \mathcal{M}} w_{i, j}^m,\]</div></div>
<p>and finally normalized,</p>
<div class="math-wrapper"><div class="math notranslate nohighlight">
\[w_{i, j} = \frac{\tilde{w}_{i, j}}{\sum_{k \in \mathcal{D}}
\tilde{w}_{i, k}}.\]</div></div>
<p>For instructions on how to get started, see the <a class="reference internal" href="quickstart.html"><span class="doc">Quickstart</span></a>.
For descriptions of the modules, objects, and functions included in <cite>weave</cite>,
see the <a class="reference internal" href="../api_reference/index.html"><span class="doc">API Reference</span></a>.</p>
<div class="section" id="depth-kernel-normalization">
<h3>Depth Kernel Normalization<a class="headerlink" href="#depth-kernel-normalization" title="Permalink to this headline">¶</a></h3>
<p>Note that when the depth kernel is used, the preceding dimension weights are
normalized in groups based on the values of the depth kernel weights. This
corresponds to the CODEm framework where the product of age and time weights
are normalized in groups based on the location hierarchy before being
multiplied by the location weights. For example, if <span class="math notranslate nohighlight">\(m_n\)</span> is a dimension
that uses the depth kernel, we let <span class="math notranslate nohighlight">\(\mathcal{D}_{i, j}\)</span> be the set of all
indices <span class="math notranslate nohighlight">\(k \in \mathcal{D}\)</span> such that
<span class="math notranslate nohighlight">\(w_{i, k}^{m_n} = w_{i, j}^{m_n}\)</span>. Then the intermediate combined weights
are given by</p>
<div class="math-wrapper"><div class="math notranslate nohighlight">
\[\tilde{w}_{i, j} = w_{i, j}^{m_n} \,
\frac{\prod_{\ell = 1, \dots, n - 1} w_{i, j}^{m_\ell}}
{\sum_{k \in \mathcal{D}_{i, j}} \prod_{\ell = 1, \dots, n - 1}
w_{i, k}^{m_\ell}}.\]</div></div>
</div>
</div>
</div>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="installation.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Installation</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="index.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">User Guide</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2021, IHME Math Sciences |
          Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
          <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            | <a class="muted-link" href="../_sources/user_guide/intro.rst.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">What is <cite>weave</cite>?</a><ul>
<li><a class="reference internal" href="#cause-of-death-ensemble-model">Cause of Death Ensemble Model</a><ul>
<li><a class="reference internal" href="#spatial-temporal-models">Spatial-Temporal Models</a></li>
</ul>
</li>
<li><a class="reference internal" href="#weighted-averages-with-weave">Weighted Averages with <cite>weave</cite></a><ul>
<li><a class="reference internal" href="#depth-kernel-normalization">Depth Kernel Normalization</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>